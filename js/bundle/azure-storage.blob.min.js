// Azure Storage JavaScript Client Library 0.2.2-preview.5 
// Copyright (c) Microsoft and contributors. All rights reserved. 
require=function e(t,n,o){function r(a,i){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!i&&l)return l(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n||e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){var o=window.AzureStorage||{};o.generateDevelopmentStorageCredentials=function(e){var t="UseDevelopmentStorage=true;";return e&&(t+="DevelopmentStorageProxyUri="+e),t};var r=e("../lib/services/blob/blobservice.browser");o.BlobService=r,o.BlobUtilities=e("../lib/services/blob/blobutilities"),o.createBlobService=function(e,t,n){return new r(e,t,n,null)},o.createBlobServiceWithSas=function(e,t){return new r(null,null,e,t)},o.createBlobServiceAnonymous=function(e){return new r(null,null,e,null)};var s=e("../lib/common/common.browser"),a=s.StorageServiceClient,i=s.SharedKey;o.generateAccountSharedAccessSignature=function(e,t,n){var o=a.getStorageSettings(e,t);return new i(o._name,o._key).generateAccountSignedQueryString(n)},o.Constants=s.Constants,o.StorageUtilities=s.StorageUtilities,o.AccessCondition=s.AccessCondition,o.SR=s.SR,o.StorageServiceClient=a,o.Logger=s.Logger,o.WebResource=s.WebResource,o.Validate=s.validate,o.date=s.date,o.LinearRetryPolicyFilter=s.LinearRetryPolicyFilter,o.ExponentialRetryPolicyFilter=s.ExponentialRetryPolicyFilter,o.RetryPolicyFilter=s.RetryPolicyFilter,window.AzureStorage=o},{"../lib/common/common.browser":5,"../lib/services/blob/blobservice.browser":39,"../lib/services/blob/blobutilities":41}],39:[function(e,t,n){var o=e("./blobservice.core");t.exports=o},{"./blobservice.core":40}],40:[function(e,t,n){(function(n){function o(e,t,n,r,s){var a=h.getStorageSettings(e,t,n,r,s);o.super_.call(this,a._name,a._key,a._blobEndpoint,a._usePathStyleUri,a._sasToken),this.defaultEnableReuseSocket=S.DEFAULT_ENABLE_REUSE_SOCKET,this.singleBlobPutThresholdInBytes=T.DEFAULT_SINGLE_BLOB_PUT_THRESHOLD_IN_BYTES,this.parallelOperationThreadCount=S.DEFAULT_PARALLEL_OPERATION_THREAD_COUNT}function r(e,t,n){return t&&!n&&(t=(t=(t=(t=encodeURIComponent(t)).replace(/%2F/g,"/")).replace(/%5C/g,"/")).replace(/\+/g,"%20")),t?e+"/"+t:e}var s=e("querystring"),a=e("url"),i=e("util"),l=e("underscore"),c=e("extend"),u=e("./../../common/common.core"),p=e("./internal/blockrangestream"),d=e("./../../common/md5-wrapper"),b=e("./internal/pagerangestream"),m=e("./../../common/streams/rangestream"),g=u.util,f=u.SR,E=u.validate,h=u.StorageServiceClient,_=u.WebResource,S=u.Constants,T=S.BlobConstants,B=S.HeaderConstants,A=S.QueryStringConstants,R=S.RequestLocationMode,I=u.BatchOperation,N=u.SpeedSummary,y=u.ChunkAllocator,C=u.ChunkStream,O=u.ChunkStreamWithStream,P=u.AclResult,v=u.ServiceStatsParser,L=e("./models/blocklistresult"),M=e("./models/blobresult"),D=e("./models/containerresult"),w=e("./models/leaseresult"),k=e("./blobutilities"),H=e("../../common/errors/errors"),F=H.ArgumentError,x=H.ArgumentNullError,V=H.StorageError;i.inherits(o,h),o.prototype.getServiceStats=function(e,t){var n;g.normalizeArgs(e,t,function(e,o){n=e,t=o}),E.validateArgs("getServiceStats",function(e){e.callback(t)});var o=_.get().withQueryOption(A.COMP,"stats").withQueryOption(A.RESTYPE,"service");n.requestLocationMode=R.PRIMARY_OR_SECONDARY;this.performRequest(o,null,n,function(e,n){e.serviceStatsResult=null,e.error||(e.serviceStatsResult=v.parse(e.response.body.StorageServiceStats));n(e,function(e){t(e.error,e.serviceStatsResult,e.response)})})},o.prototype.getServiceProperties=function(e,t){return this.getAccountServiceProperties(e,t)},o.prototype.setServiceProperties=function(e,t,n){return this.setAccountServiceProperties(e,t,n)},o.prototype.listContainersSegmented=function(e,t,n){this.listContainersSegmentedWithPrefix(null,e,t,n)},o.prototype.listContainersSegmentedWithPrefix=function(e,t,n,o){var r;g.normalizeArgs(n,o,function(e,t){r=e,o=t}),E.validateArgs("listContainers",function(e){e.callback(o)});var s=c(!0,{},r),a=_.get().withQueryOption(A.COMP,"list").withQueryOption(A.MAX_RESULTS,s.maxResults).withQueryOption(A.INCLUDE,s.include);g.objectIsNull(t)||a.withQueryOption(A.MARKER,t.nextMarker),a.withQueryOption(A.PREFIX,e),s.requestLocationMode=g.getNextListingLocationMode(t);this.performRequest(a,null,s,function(e,t){if(e.listContainersResult=null,!e.error){e.listContainersResult={entries:null,continuationToken:null},e.listContainersResult.entries=[];var n=[];e.response.body.EnumerationResults.Containers&&e.response.body.EnumerationResults.Containers.Container&&(n=e.response.body.EnumerationResults.Containers.Container,l.isArray(n)||(n=[n])),n.forEach(function(t){var n=D.parse(t);e.listContainersResult.entries.push(n)}),e.response.body.EnumerationResults.NextMarker&&(e.listContainersResult.continuationToken={nextMarker:null,targetLocation:null},e.listContainersResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listContainersResult.continuationToken.targetLocation=e.targetLocation)}t(e,function(e){o(e.error,e.listContainersResult,e.response)})})},o.prototype.doesContainerExist=function(e,t,n){var o;g.normalizeArgs(t,n,function(e,t){o=e,n=t}),E.validateArgs("doesContainerExist",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(n)});var r=c(!0,{},o);this._doesContainerExist(e,!1,r,n)},o.prototype.createContainer=function(e,t,n){var o;g.normalizeArgs(t,n,function(e,t){o=e,n=t}),E.validateArgs("createContainer",function(t){t.string(e,"container"),t.test(function(){return"$logs"!==e},"Container name format is incorrect"),t.containerNameIsValid(e),t.callback(n)});var r=c(!0,{},o),s=_.put(e).withQueryOption(A.RESTYPE,"container");s.addOptionalMetadataHeaders(r.metadata),s.withHeader(B.BLOB_PUBLIC_ACCESS,r.publicAccessLevel);this.performRequest(s,null,r,function(t,o){t.containerResult=null,t.error||(t.containerResult=new D(e),t.containerResult.getPropertiesFromHeaders(t.response.headers),r.metadata&&(t.containerResult.metadata=r.metadata));o(t,function(e){n(e.error,e.containerResult,e.response)})})},o.prototype.createContainerIfNotExists=function(e,t,n){var o;g.normalizeArgs(t,n,function(e,t){o=e,n=t}),E.validateArgs("createContainerIfNotExists",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(n)});var r=c(!0,{},o),s=this;s._doesContainerExist(e,!0,r,function(t,o,a){var i=o.exists;o.created=!1,delete o.exists,t?n(t,o,a):i?(a.isSuccessful=!0,n(t,o,a)):s.createContainer(e,r,function(e,t,o){e?e&&e.statusCode===S.HttpConstants.HttpResponseCodes.Conflict&&e.code===S.BlobErrorCodeStrings.CONTAINER_ALREADY_EXISTS&&(e=null,o.isSuccessful=!0):t.created=!0,n(e,t,o)})})},o.prototype.getContainerProperties=function(e,t,n){var o;g.normalizeArgs(t,n,function(e,t){o=e,n=t}),E.validateArgs("getContainerProperties",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(n)});var r=c(!0,{},o),s=_.head(e).withQueryOption(A.RESTYPE,"container").withHeader(B.LEASE_ID,r.leaseId);r.requestLocationMode=S.RequestLocationMode.PRIMARY_OR_SECONDARY;var a=this;this.performRequest(s,null,r,function(t,o){t.containerResult=null,t.error||(t.containerResult=new D(e),t.containerResult.metadata=a.parseMetadataHeaders(t.response.headers),t.containerResult.getPropertiesFromHeaders(t.response.headers));o(t,function(e){n(e.error,e.containerResult,e.response)})})},o.prototype.getContainerMetadata=function(e,t,n){var o;g.normalizeArgs(t,n,function(e,t){o=e,n=t}),E.validateArgs("getContainerMetadata",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(n)});var r=c(!0,{},o),s=_.head(e).withQueryOption(A.RESTYPE,"container").withQueryOption(A.COMP,"metadata").withHeader(B.LEASE_ID,r.leaseId);r.requestLocationMode=S.RequestLocationMode.PRIMARY_OR_SECONDARY;var a=this;this.performRequest(s,null,r,function(t,o){t.containerResult=null,t.error||(t.containerResult=new D(e),t.containerResult.metadata=a.parseMetadataHeaders(t.response.headers),t.containerResult.getPropertiesFromHeaders(t.response.headers));o(t,function(e){n(e.error,e.containerResult,e.response)})})},o.prototype.setContainerMetadata=function(e,t,n,o){var r;g.normalizeArgs(n,o,function(e,t){r=e,o=t}),E.validateArgs("setContainerMetadata",function(n){n.string(e,"container"),n.object(t,"metadata"),n.containerNameIsValid(e),n.callback(o)});var s=c(!0,{},r),a=_.put(e).withQueryOption(A.RESTYPE,"container").withQueryOption(A.COMP,"metadata").withHeader(B.LEASE_ID,s.leaseId);a.addOptionalMetadataHeaders(t);this.performRequest(a,null,s,function(t,n){t.containerResult=null,t.error||(t.containerResult=new D(e),t.containerResult.getPropertiesFromHeaders(t.response.headers));n(t,function(e){o(e.error,e.containerResult,e.response)})})},o.prototype.getContainerAcl=function(e,t,n){var o;g.normalizeArgs(t,n,function(e,t){o=e,n=t}),E.validateArgs("getContainerAcl",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(n)});var r=c(!0,{},o),s=_.get(e).withQueryOption(A.RESTYPE,"container").withQueryOption(A.COMP,"acl").withHeader(B.LEASE_ID,r.leaseId);r.requestLocationMode=S.RequestLocationMode.PRIMARY_OR_SECONDARY;this.performRequest(s,null,r,function(t,o){t.containerResult=null,t.error||(t.containerResult=new D(e),t.containerResult.getPropertiesFromHeaders(t.response.headers),t.containerResult.signedIdentifiers=P.parse(t.response.body));o(t,function(e){n(e.error,e.containerResult,e.response)})})},o.prototype.setContainerAcl=function(e,t,o,r){var s;g.normalizeArgs(o,r,function(e,t){s=e,r=t}),E.validateArgs("setContainerAcl",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(r)});var a=c(!0,{},s),i=null;if(t){if(l.isArray(t))throw new TypeError(f.INVALID_SIGNED_IDENTIFIERS);i=P.serialize(t)}var u=_.put(e).withQueryOption(A.RESTYPE,"container").withQueryOption(A.COMP,"acl").withHeader(B.CONTENT_LENGTH,g.objectIsNull(i)?0:n.byteLength(i)).withHeader(B.BLOB_PUBLIC_ACCESS,a.publicAccessLevel).withHeader(B.LEASE_ID,a.leaseId).withBody(i);this.performRequest(u,u.body,a,function(n,o){n.containerResult=null,n.error||(n.containerResult=new D(e,a.publicAccessLevel),n.containerResult.getPropertiesFromHeaders(n.response.headers),t&&(n.containerResult.signedIdentifiers=t));o(n,function(e){r(e.error,e.containerResult,e.response)})})},o.prototype.deleteContainer=function(e,t,n){var o;g.normalizeArgs(t,n,function(e,t){o=e,n=t}),E.validateArgs("deleteContainer",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(n)});var r=c(!0,{},o),s=_.del(e).withQueryOption(A.RESTYPE,"container").withHeader(B.LEASE_ID,r.leaseId);this.performRequest(s,null,r,function(e,t){t(e,function(e){n(e.error,e.response)})})},o.prototype.deleteContainerIfExists=function(e,t,n){var o;g.normalizeArgs(t,n,function(e,t){o=e,n=t}),E.validateArgs("deleteContainerIfExists",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(n)});var r=c(!0,{},o),s=this;s._doesContainerExist(e,!0,r,function(t,o,a){t?n(t,o.exists,a):o.exists?s.deleteContainer(e,r,function(e,t){var o;e?e&&e.statuscode===S.HttpConstants.HttpResponseCodes.NotFound&&e.code===S.BlobErrorCodeStrings.CONTAINER_NOT_FOUND&&(o=!1,e=null,t.isSuccessful=!0):o=!0,n(e,o,t)}):(a.isSuccessful=!0,n(t,!1,a))})},o.prototype.listBlobDirectoriesSegmented=function(e,t,n,o){this.listBlobDirectoriesSegmentedWithPrefix(e,null,t,n,o)},o.prototype.listBlobDirectoriesSegmentedWithPrefix=function(e,t,n,o,r){var s;g.normalizeArgs(o,r,function(e,t){s=e,r=t}),s.delimiter="/",this._listBlobsOrDircotriesSegmentedWithPrefix(e,t,n,T.ListBlobTypes.Directory,s,r)},o.prototype.listBlobsSegmented=function(e,t,n,o){this.listBlobsSegmentedWithPrefix(e,null,t,n,o)},o.prototype.listBlobsSegmentedWithPrefix=function(e,t,n,o,r){this._listBlobsOrDircotriesSegmentedWithPrefix(e,t,n,T.ListBlobTypes.Blob,o,r)},o.prototype.acquireLease=function(e,t,n,o){var r;g.normalizeArgs(n,o,function(e,t){r=e,o=t}),E.validateArgs("acquireLease",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(o)});var s=c(!0,{},r);s.leaseDuration||(s.leaseDuration=-1),this._leaseImpl(e,t,null,T.LeaseOperation.ACQUIRE,s,o)},o.prototype.renewLease=function(e,t,n,o,r){var s;g.normalizeArgs(o,r,function(e,t){s=e,r=t}),E.validateArgs("renewLease",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(r)});var a=c(!0,{},s);this._leaseImpl(e,t,n,T.LeaseOperation.RENEW,a,r)},o.prototype.changeLease=function(e,t,n,o,r,s){var a;g.normalizeArgs(r,s,function(e,t){a=e,s=t}),E.validateArgs("changeLease",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(s)});var i=c(!0,{},a);i.proposedLeaseId=o,this._leaseImpl(e,t,n,T.LeaseOperation.CHANGE,i,s)},o.prototype.releaseLease=function(e,t,n,o,r){var s;g.normalizeArgs(o,r,function(e,t){s=e,r=t}),E.validateArgs("releaseLease",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(r)});var a=c(!0,{},s);this._leaseImpl(e,t,n,T.LeaseOperation.RELEASE,a,r)},o.prototype.breakLease=function(e,t,n,o){var r;g.normalizeArgs(n,o,function(e,t){r=e,o=t}),E.validateArgs("breakLease",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(o)});var s=c(!0,{},r);this._leaseImpl(e,t,null,T.LeaseOperation.BREAK,s,o)},o.prototype.getBlobProperties=function(e,t,n,o){var s;g.normalizeArgs(n,o,function(e,t){s=e,o=t}),E.validateArgs("getBlobProperties",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var a=c(!0,{},s),i=r(e,t),l=_.head(i);a.snapshotId&&l.withQueryOption(A.SNAPSHOT,a.snapshotId),M.setHeadersFromBlob(l,a),a.requestLocationMode=S.RequestLocationMode.PRIMARY_OR_SECONDARY;var u=this;this.performRequest(l,null,a,function(n,r){n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.metadata=u.parseMetadataHeaders(n.response.headers),n.blobResult.getPropertiesFromHeaders(n.response.headers));r(n,function(e){o(e.error,e.blobResult,e.response)})})},o.prototype.getBlobMetadata=function(e,t,n,o){var s;g.normalizeArgs(n,o,function(e,t){s=e,o=t}),E.validateArgs("getBlobMetadata",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var a=c(!0,{},s),i=r(e,t),l=_.head(i);l.withQueryOption(A.COMP,"metadata"),l.withQueryOption(A.SNAPSHOT,a.snapshotId),M.setHeadersFromBlob(l,a),a.requestLocationMode=S.RequestLocationMode.PRIMARY_OR_SECONDARY;var u=this;this.performRequest(l,null,a,function(n,r){n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.metadata=u.parseMetadataHeaders(n.response.headers),n.blobResult.getPropertiesFromHeaders(n.response.headers));r(n,function(e){o(e.error,e.blobResult,e.response)})})},o.prototype.setBlobProperties=function(e,t,n,o,s){var a;g.normalizeArgs(o,s,function(e,t){a=e,s=t}),E.validateArgs("setBlobProperties",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(s)});var i=c(!0,{contentSettings:n},a),l=r(e,t),u=_.put(l).withQueryOption(A.COMP,"properties");M.setPropertiesFromBlob(u,i),this._setBlobPropertiesHelper({webResource:u,options:i,container:e,blob:t,callback:s})},o.prototype.setBlobMetadata=function(e,t,n,o,s){var a;g.normalizeArgs(o,s,function(e,t){a=e,s=t}),E.validateArgs("setBlobMetadata",function(o){o.string(e,"container"),o.string(t,"blob"),o.object(n,"metadata"),o.containerNameIsValid(e),o.callback(s)});var i=c(!0,{},a),l=r(e,t),u=_.put(l).withQueryOption(A.COMP,"metadata");u.withQueryOption(A.SNAPSHOT,i.snapshotId),i.metadata=n,M.setHeadersFromBlob(u,i);this.performRequest(u,null,i,function(n,o){n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.getPropertiesFromHeaders(n.response.headers));o(n,function(e){s(e.error,e.blobResult,e.response)})})},o.prototype.createReadStream=function(e,t,n,o){var r;g.normalizeArgs(n,o,function(e,t){r=e,o=t}),E.validateArgs("createReadStream",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e)});var s=new C;return this.getBlobToStream(e,t,s,r,function(e,t,n){e&&s.emit("error",e),o&&o(e,t,n)}),s},o.prototype.getBlobToStream=function(e,t,n,o,r){var s;g.normalizeArgs(o,r,function(e,t){s=e,r=t}),s.speedSummary=s.speedSummary||new N(t),E.validateArgs("getBlobToStream",function(o){o.string(e,"container"),o.string(t,"blob"),o.object(n,"writeStream"),o.containerNameIsValid(e),o.callback(r)});var a=c(!0,{},s),i={timeoutIntervalInMs:a.timeoutIntervalInMs,clientRequestTimeoutInMs:a.clientRequestTimeoutInMs,snapshotId:a.snapshotId,accessConditions:a.accessConditions};if(a.skipSizeCheck)this._getBlobToStream(e,t,n,a,r);else{var l=this;this.getBlobProperties(e,t,i,function(o,s){if(o)r(o);else{var i;if(a.rangeStart){var c=s.contentLength-1;i=(a.rangeEnd?Math.min(a.rangeEnd,c):c)-a.rangeStart+1}else i=s.contentLength;a.speedSummary.totalSize=i,i>l.singleBlobPutThresholdInBytes?(g.setObjectInnerPropertyValue(a,["contentSettings","contentMD5"],g.tryGetValueChain(s,["contentSettings","contentMD5"],null)),l._getBlobToRangeStream(e,t,s.blobType,n,a,r)):l._getBlobToStream(e,t,n,a,r)}})}return a.speedSummary},o.prototype.getBlobToText=function(e,t,n,o){var s;g.normalizeArgs(n,o,function(e,t){s=e,o=t}),E.validateArgs("getBlobToText",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var a=c(!0,{},s),i=r(e,t),l=_.get(i).withRawResponse();l.withQueryOption(A.SNAPSHOT,a.snapshotId),M.setHeadersFromBlob(l,a),this._setRangeContentMD5Header(l,a),a.requestLocationMode=S.RequestLocationMode.PRIMARY_OR_SECONDARY;var u=this;this.performRequest(l,null,a,function(n,r){n.text=null,n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.metadata=u.parseMetadataHeaders(n.response.headers),n.blobResult.getPropertiesFromHeaders(n.response.headers),n.text=n.response.body,u._validateLengthAndMD5(a,n));r(n,function(e){o(e.error,e.text,e.blobResult,e.response)})})},o.prototype.deleteBlob=function(e,t,n,o){var s;g.normalizeArgs(n,o,function(e,t){s=e,o=t}),E.validateArgs("deleteBlob",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var a=c(!0,{},s),i=r(e,t),l=_.del(i).withHeader(B.LEASE_ID,a.leaseId);if(!g.objectIsNull(a.snapshotId)&&!g.objectIsNull(a.deleteSnapshots))throw new F("options",f.INVALID_DELETE_SNAPSHOT_OPTION);l.withQueryOption(A.SNAPSHOT,a.snapshotId),l.withHeader(B.DELETE_SNAPSHOT,a.deleteSnapshots),M.setHeadersFromBlob(l,a);this.performRequest(l,null,a,function(e,t){t(e,function(e){o(e.error,e.response)})})},o.prototype.doesBlobExist=function(e,t,n,o){var r;g.normalizeArgs(n,o,function(e,t){r=e,o=t}),E.validateArgs("doesBlobExist",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var s=c(!0,{},r);this._doesBlobExist(e,t,!1,s,o)},o.prototype.deleteBlobIfExists=function(e,t,n,o){var r;g.normalizeArgs(n,o,function(e,t){r=e,o=t}),E.validateArgs("deleteBlobIfExists",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var s=c(!0,{},r),a=this;a._doesBlobExist(e,t,!0,s,function(n,r,i){n?o(n,r.exists,i):r.exists?a.deleteBlob(e,t,s,function(e,t){var n;e?e&&e.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&e.code===S.BlobErrorCodeStrings.BLOB_NOT_FOUND&&(n=!1,e=null,t.isSuccessful=!0):n=!0,o(e,n,t)}):(i.isSuccessful=!0,o(n,!1,i))})},o.prototype.createBlobSnapshot=function(e,t,n,o){var s;g.normalizeArgs(n,o,function(e,t){s=e,o=t}),E.validateArgs("createBlobSnapshot",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var a=c(!0,{},s),i=r(e,t),l=_.put(i).withQueryOption(A.COMP,"snapshot");M.setHeadersFromBlob(l,a);this.performRequest(l,null,a,function(e,t){e.snapshotId=null,e.error||(e.snapshotId=e.response.headers[B.SNAPSHOT]);t(e,function(e){o(e.error,e.snapshotId,e.response)})})},o.prototype.startCopyBlob=function(e,t,n,o,s){var i;g.normalizeArgs(o,s,function(e,t){i=e,s=t}),E.validateArgs("startCopyBlob",function(o){o.string(e,"sourceUri"),o.string(t,"targetContainer"),o.string(n,"targetBlob"),o.containerNameIsValid(t),o.callback(s)});var l=r(t,n),u=c(!0,{},i);if(u.snapshotId){var p=a.parse(e,!0);if(p.query.snapshot)throw new F("options.snapshotId","Duplicate snapshot supplied in both the source uri and option.");p.search=void 0,p.query.snapshot=u.snapshotId,e=a.format(p)}var d=_.put(l).withHeader(B.COPY_SOURCE,e);u.isIncrementalCopy&&d.withQueryOption(A.COMP,"incrementalcopy"),d.withHeader(B.LEASE_ID,u.leaseId),d.withHeader(B.SOURCE_LEASE_ID,u.sourceLeaseId),d.addOptionalMetadataHeaders(u.metadata);this.performRequest(d,null,u,function(e,o){e.blobResult=null,e.error||(e.blobResult=new M(t,n),e.blobResult.getPropertiesFromHeaders(e.response.headers),u.metadata&&(e.blobResult.metadata=u.metadata));o(e,function(e){s(e.error,e.blobResult,e.response)})})},o.prototype.abortCopyBlob=function(e,t,n,o,s){var a;g.normalizeArgs(o,s,function(e,t){a=e,s=t}),E.validateArgs("abortCopyBlob",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(s)});var i=r(e,t),l=c(!0,{},a),u=_.put(i).withQueryOption(A.COPY_ID,n).withQueryOption(A.COMP,"copy").withHeader(B.COPY_ACTION,"abort");u.withHeader(B.LEASE_ID,l.leaseId);this.performRequest(u,null,l,function(e,t){t(e,function(e){s(e.error,e.response)})})},o.prototype.generateSharedAccessSignature=function(e,t,n,o){if(!this.storageCredentials)throw new x("storageCredentials");if(!this.storageCredentials.generateSignedQueryString)throw new F("storageCredentials",f.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY);E.validateArgs("generateSharedAccessSignature",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.object(n,"sharedAccessPolicy")});var s=T.ResourceTypes.CONTAINER;t&&(E.validateArgs("generateSharedAccessSignature",function(e){e.string(t,"blob")}),s=T.ResourceTypes.BLOB),n.AccessPolicy&&(g.objectIsNull(n.AccessPolicy.Start)||(l.isDate(n.AccessPolicy.Start)||(n.AccessPolicy.Start=new Date(n.AccessPolicy.Start)),n.AccessPolicy.Start=g.truncatedISO8061Date(n.AccessPolicy.Start)),g.objectIsNull(n.AccessPolicy.Expiry)||(l.isDate(n.AccessPolicy.Expiry)||(n.AccessPolicy.Expiry=new Date(n.AccessPolicy.Expiry)),n.AccessPolicy.Expiry=g.truncatedISO8061Date(n.AccessPolicy.Expiry)));var a=r(e,t,!0);return this.storageCredentials.generateSignedQueryString(S.ServiceType.Blob,a,n,null,{headers:o,resourceType:s})},o.prototype.getUrl=function(e,t,n,o,i){E.validateArgs("getUrl",function(t){t.string(e,"container"),t.containerNameIsValid(e)});var l;l=g.objectIsNull(o)||!1!==o?this.host.primaryHost:this.host.secondaryHost,(l=g.trimPortFromUri(l))&&l.lastIndexOf("/")!==l.length-1&&(l+="/");var c=s.parse(n);i&&(c[A.SNAPSHOT]=i);var u=a.format({pathname:this._getPath(r(e,t)),query:c});return a.resolve(l,u)},o.prototype.createPageBlob=function(e,t,n,o,s){var a;if(g.normalizeArgs(o,s,function(e,t){a=e,s=t}),E.validateArgs("createPageBlob",function(o){o.string(e,"container"),o.string(t,"blob"),o.containerNameIsValid(e),o.value(n,"length"),o.callback(s)}),n&&n%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_BLOB_LENGTH);var i=c(!0,{},a),l=r(e,t),u=_.put(l).withHeader(B.BLOB_TYPE,T.BlobTypes.PAGE).withHeader(B.BLOB_CONTENT_LENGTH,n).withHeader(B.CONTENT_LENGTH,0).withHeader(B.LEASE_ID,i.leaseId);M.setHeadersFromBlob(u,i);this.performRequest(u,null,i,function(e,t){t(e,function(e){s(e.error,e.response)})})},o.prototype.createPageBlobFromStream=function(e,t,n,o,r,s){return this._createBlobFromStream(e,t,T.BlobTypes.PAGE,n,o,r,s)},o.prototype.createWriteStreamToExistingPageBlob=function(e,t,n,o){return this._createWriteStreamToBlob(e,t,T.BlobTypes.PAGE,0,!1,n,o)},o.prototype.createWriteStreamToNewPageBlob=function(e,t,n,o,r){return this._createWriteStreamToBlob(e,t,T.BlobTypes.PAGE,n,!0,o,r)},o.prototype.createPagesFromStream=function(e,t,n,o,r,s,a){var i;g.normalizeArgs(s,a,function(e,t){i=e,a=t}),E.validateArgs("createPagesFromStream",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(a)});var l=c(!0,{},i);if(r-o+1>T.MAX_UPDATE_PAGE_SIZE)throw new RangeError(f.INVALID_PAGE_RANGE_FOR_UPDATE);var u=this;g.objectIsNull(l.transactionalContentMD5)&&l.useTransactionalMD5?g.calculateMD5(n,T.MAX_UPDATE_PAGE_SIZE,l,function(n,s){l.transactionalContentMD5=s,u._createPages(e,t,n,null,o,r,l,a)}):u._createPages(e,t,null,n,o,r,l,a)},o.prototype.listPageRanges=function(e,t,n,o){var s;g.normalizeArgs(n,o,function(e,t){s=e,o=t}),E.validateArgs("listPageRanges",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var a=c(!0,{},s),i=r(e,t),u=_.get(i).withQueryOption(A.COMP,"pagelist").withQueryOption(A.SNAPSHOT,a.snapshotId);if(a.rangeStart&&a.rangeStart%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_START_OFFSET);if(a.rangeEnd&&(a.rangeEnd+1)%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_END_OFFSET);M.setHeadersFromBlob(u,a),a.requestLocationMode=R.PRIMARY_OR_SECONDARY;this.performRequest(u,null,a,function(e,t){if(e.pageRanges=null,!e.error){e.pageRanges=[];var n=[];e.response.body.PageList.PageRange&&(n=e.response.body.PageList.PageRange,l.isArray(n)||(n=[n])),n.forEach(function(t){var n={start:parseInt(t.Start,10),end:parseInt(t.End,10)};e.pageRanges.push(n)})}t(e,function(e){o(e.error,e.pageRanges,e.response)})})},o.prototype.getPageRangesDiff=function(e,t,n,o,s){var a;g.normalizeArgs(o,s,function(e,t){a=e,s=t}),E.validateArgs("getPageRangesDiff",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(s)});var i=c(!0,{},a),u=r(e,t),p=_.get(u).withQueryOption(A.COMP,"pagelist").withQueryOption(A.SNAPSHOT,i.snapshotId).withQueryOption(A.PREV_SNAPSHOT,n);if(i.rangeStart&&i.rangeStart%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_START_OFFSET);if(i.rangeEnd&&(i.rangeEnd+1)%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_END_OFFSET);if(i.rangeEnd&&(i.rangeEnd+1)%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_END_OFFSET);M.setHeadersFromBlob(p,i),i.requestLocationMode=R.PRIMARY_OR_SECONDARY;this.performRequest(p,null,i,function(e,t){if(e.pageRangesDiff=null,!e.error){if(e.pageRangesDiff=[],e.response.body.PageList.PageRange){var n=e.response.body.PageList.PageRange;l.isArray(n)||(n=[n]),n.forEach(function(t){var n={start:parseInt(t.Start,10),end:parseInt(t.End,10),isCleared:!1};e.pageRangesDiff.push(n)})}if(e.response.body.PageList.ClearRange){var o=e.response.body.PageList.ClearRange;l.isArray(o)||(o=[o]),o.forEach(function(t){var n={start:parseInt(t.Start,10),end:parseInt(t.End,10),isCleared:!0};e.pageRangesDiff.push(n)})}}t(e,function(e){s(e.error,e.pageRangesDiff,e.response)})})},o.prototype.clearPageRange=function(e,t,n,o,r,s){var a;g.normalizeArgs(r,s,function(e,t){a=e,s=t}),E.validateArgs("clearPageRange",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(s)});var i=c(!0,{},a),l=this._updatePageBlobPagesImpl(e,t,n,o,T.PageWriteOptions.CLEAR,i);this.performRequest(l,null,i,function(e,t){t(e,function(e){s(e.error,e.response)})})},o.prototype.resizePageBlob=function(e,t,n,o,s){var a;g.normalizeArgs(o,s,function(e,t){a=e,s=t}),E.validateArgs("resizePageBlob",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(s)});var i=c(!0,{},a),l=r(e,t),u=_.put(l).withQueryOption(A.COMP,"properties");if(n&&n%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_BLOB_LENGTH);u.withHeader(B.BLOB_CONTENT_LENGTH,n),this._setBlobPropertiesHelper({webResource:u,options:i,container:e,blob:t,callback:s})},o.prototype.setPageBlobSequenceNumber=function(e,t,n,o,s,a){var l;if(g.normalizeArgs(s,a,function(e,t){l=e,a=t}),E.validateArgs("setPageBlobSequenceNumber",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(a)}),n===k.SequenceNumberAction.INCREMENT){if(!g.objectIsNull(o))throw new F("sequenceNumber",f.BLOB_INVALID_SEQUENCE_NUMBER)}else if(g.objectIsNull(o))throw new x("sequenceNumber",i.format(f.ARGUMENT_NULL_OR_EMPTY,"sequenceNumber"));var u=c(!0,{},l),p=r(e,t),d=_.put(p).withQueryOption(A.COMP,"properties").withHeader(B.SEQUENCE_NUMBER_ACTION,n);n!==k.SequenceNumberAction.INCREMENT&&d.withHeader(B.SEQUENCE_NUMBER,o);this.performRequest(d,null,u,function(n,o){n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.getPropertiesFromHeaders(n.response.headers));o(n,function(e){a(e.error,e.blobResult,e.response)})})},o.prototype.createBlockBlobFromStream=function(e,t,n,o,r,s){return this._createBlobFromStream(e,t,T.BlobTypes.BLOCK,n,o,r,s)},o.prototype.createBlockBlobFromText=function(e,t,n,o,r){return this._createBlobFromText(e,t,T.BlobTypes.BLOCK,n,o,r)},o.prototype.createWriteStreamToBlockBlob=function(e,t,n,o){return this._createWriteStreamToBlob(e,t,T.BlobTypes.BLOCK,0,!1,n,o)},o.prototype.createBlockFromStream=function(e,t,n,o,r,s,a){var i;g.normalizeArgs(s,a,function(e,t){i=e,a=t}),E.validateArgs("createBlockFromStream",function(e){e.string(t,"container"),e.string(n,"blob"),e.containerNameIsValid(t),e.exists(o,"readStream"),e.value(r,"streamLength"),e.callback(a)});var l=c(!0,{},i);if(r>T.MAX_BLOCK_BLOB_BLOCK_SIZE)throw new RangeError(f.INVALID_STREAM_LENGTH);this._createBlock(e,t,n,null,o,r,l,a)},o.prototype.createBlockFromText=function(e,t,o,r,s,a){var i;g.normalizeArgs(s,a,function(e,t){i=e,a=t}),E.validateArgs("createBlockFromText",function(e){e.string(t,"container"),e.string(o,"blob"),e.containerNameIsValid(t),e.callback(a)});var l=c(!0,{},i),u=n.isBuffer(r)?r.length:n.byteLength(r);if(u>T.MAX_BLOCK_BLOB_BLOCK_SIZE)throw new RangeError(f.INVALID_TEXT_LENGTH);this._createBlock(e,t,o,r,null,u,l,a)},o.prototype._createBlock=function(e,t,o,s,a,i,l,c){var u=r(t,o),p=this,d=function(){var t=_.put(u).withQueryOption(A.COMP,"block").withQueryOption(A.BLOCK_ID,new n(e).toString("base64")).withHeader(B.CONTENT_LENGTH,i);M.setHeadersFromBlob(t,l);var o=function(e,t){t(e,function(e){c(e.error,e.response)})};g.objectIsNull(s)?p.performRequestOutputStream(t,a,l,o):p.performRequest(t,s,l,o)};g.objectIsNull(l.transactionalContentMD5)&&l.useTransactionalMD5?g.objectIsNull(s)?g.calculateMD5(a,i,l,function(e,t){l.transactionalContentMD5=t,s=e,i=e.length,d()}):(l.transactionalContentMD5=g.getContentMd5(s),d()):d()},o.prototype.commitBlocks=function(e,t,o,s,a){var i;g.normalizeArgs(s,a,function(e,t){i=e,a=t}),E.validateArgs("commitBlocks",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(a)});var l=L.serialize(o),u=r(e,t),p=c(!0,{},i),d=_.put(u).withQueryOption(A.COMP,"blocklist").withHeader(B.CONTENT_LENGTH,n.byteLength(l)).withBody(l);M.setPropertiesFromBlob(d,p);this.performRequest(d,d.body,p,function(n,r){n.blobResult=new M(e,t),n.blobResult.list=null,n.error||(n.blobResult.getPropertiesFromHeaders(n.response.headers),n.blobResult.list=o);r(n,function(e){a(e.error,e.blobResult,e.response)})})},o.prototype.listBlocks=function(e,t,n,o,s){var a;g.normalizeArgs(o,s,function(e,t){a=e,s=t}),E.validateArgs("listBlocks",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(s)});var i=r(e,t),l=c(!0,{},a),u=_.get(i).withQueryOption(A.COMP,"blocklist").withQueryOption(A.BLOCK_LIST_TYPE,n).withQueryOption(A.SNAPSHOT,l.snapshotId);l.requestLocationMode=R.PRIMARY_OR_SECONDARY;this.performRequest(u,null,l,function(e,t){e.blockListResult=null,e.error||(e.blockListResult=L.parse(e.response.body.BlockList));t(e,function(e){s(e.error,e.blockListResult,e.response)})})},o.prototype.generateBlockIdPrefix=function(){var e=Math.floor(4294967296*Math.random()).toString(16);return g.zeroPaddingString(e,8)},o.prototype.getBlockId=function(e,t){return e+"-"+g.zeroPaddingString(t,6)},o.prototype.createOrReplaceAppendBlob=function(e,t,n,o){var s;g.normalizeArgs(n,o,function(e,t){s=e,o=t}),E.validateArgs("createOrReplaceAppendBlob",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(o)});var a=c(!0,{},s),i=r(e,t),l=_.put(i).withHeader(B.BLOB_TYPE,T.BlobTypes.APPEND).withHeader(B.LEASE_ID,a.leaseId).withHeader(B.CONTENT_LENGTH,0);M.setHeadersFromBlob(l,a);this.performRequest(l,null,a,function(e,t){t(e,function(e){o(e.error,e.response)})})},o.prototype.createAppendBlobFromStream=function(e,t,n,o,r,s){return this._createBlobFromStream(e,t,T.BlobTypes.APPEND,n,o,r,s)},o.prototype.createAppendBlobFromText=function(e,t,n,o,r){return this._createBlobFromText(e,t,T.BlobTypes.APPEND,n,o,r)},o.prototype.createWriteStreamToNewAppendBlob=function(e,t,n,o){return this._createWriteStreamToBlob(e,t,T.BlobTypes.APPEND,0,!0,n,o)},o.prototype.createWriteStreamToExistingAppendBlob=function(e,t,n,o){return this._createWriteStreamToBlob(e,t,T.BlobTypes.APPEND,0,!1,n,o)},o.prototype.appendFromStream=function(e,t,n,o,r,s){var a;return g.normalizeArgs(r,s,function(e,t){a=e,s=t}),E.validateArgs("appendFromStream",function(r){r.string(e,"container"),r.string(t,"blob"),r.containerNameIsValid(e),r.exists(n,"stream"),r.value(o,"streamLength"),r.callback(s)}),this._uploadBlobFromStream(!1,e,t,T.BlobTypes.APPEND,n,o,a,s)},o.prototype.appendFromText=function(e,t,n,o,r){return this._uploadBlobFromText(!1,e,t,T.BlobTypes.APPEND,n,o,r)},o.prototype.appendBlockFromStream=function(e,t,n,o,r,s){var a;g.normalizeArgs(r,s,function(e,t){a=e,s=t}),E.validateArgs("appendBlockFromStream",function(r){r.string(e,"container"),r.string(t,"blob"),r.containerNameIsValid(e),r.exists(n,"readStream"),r.value(o,"streamLength"),r.callback(s)});var i=c(!0,{},a);if(o>T.MAX_APPEND_BLOB_BLOCK_SIZE)throw new RangeError(f.INVALID_STREAM_LENGTH);this._appendBlock(e,t,null,n,o,i,s)},o.prototype.appendBlockFromText=function(e,t,o,r,s){var a;g.normalizeArgs(r,s,function(e,t){a=e,s=t}),E.validateArgs("appendBlockFromText",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.callback(s)});var i=c(!0,{},a),l=n.isBuffer(o)?o.length:n.byteLength(o);if(l>T.MAX_APPEND_BLOB_BLOCK_SIZE)throw new RangeError(f.INVALID_TEXT_LENGTH);this._appendBlock(e,t,o,null,l,i,s)},o.prototype._createBlobFromStream=function(e,t,n,o,r,s,a){var i;g.normalizeArgs(s,a,function(e,t){i=e,a=t}),E.validateArgs("_createBlobFromStream",function(s){s.string(e,"container"),s.string(t,"blob"),s.containerNameIsValid(e),s.blobTypeIsValid(n),s.exists(o,"stream"),s.value(r,"streamLength"),s.callback(a)});var l=c(!0,{},i),u=this;return this._createBlob(e,t,n,r,l,function(s,i,c){s?a(s,i,c):u._uploadBlobFromStream(!0,e,t,n,o,r,l,a)}),l.speedSummary},o.prototype._createBlobFromText=function(e,t,o,r,s,a){var i;g.normalizeArgs(s,a,function(e,t){i=e,a=t}),E.validateArgs("_createBlobFromText",function(n){n.string(e,"container"),n.string(t,"blob"),n.containerNameIsValid(e),n.blobTypeIsValid(o),n.callback(a)});var l=c(!0,{},i),u=this,p=g.objectIsNull(r)?0:n.isBuffer(r)?r.length:n.byteLength(r);return this._createBlob(e,t,o,p,l,function(n,s,i){n?a(n,s,i):u._uploadBlobFromText(!0,e,t,o,r,l,a)}),l.speedSummary},o.prototype._createWriteStreamToBlob=function(e,t,n,o,r,s,a){var i;g.normalizeArgs(s,a,function(e,t){i=e,a=t}),E.validateArgs("_createWriteStreamToBlob",function(o){o.string(e,"container"),o.string(t,"blob"),o.containerNameIsValid(e),o.blobTypeIsValid(n)});var l,u=c(!0,{},i);n===T.BlobTypes.BLOCK?(u.storeBlobContentMD5=!1!==u.storeBlobContentMD5,l=u.blockSize||T.DEFAULT_WRITE_BLOCK_SIZE_IN_BYTES):n==T.BlobTypes.PAGE?l=T.DEFAULT_WRITE_PAGE_SIZE_IN_BYTES:n==T.BlobTypes.APPEND&&(l=T.DEFAULT_WRITE_BLOCK_SIZE_IN_BYTES);var p=new C({calcContentMd5:u.storeBlobContentMD5});p._highWaterMark=l,p.pause();var d=this,b=function(o,s,i){o?a&&a(o,s,i):d._uploadBlobFromStream(r,e,t,n,p,null,u,function(e,t,n){e&&p.emit("error",e),a&&a(e,t,n)})};return!0===r?this._createBlob(e,t,n,o,u,b):b(),p},o.prototype._uploadBlobFromStream=function(e,t,n,o,r,s,a,i){var l;g.normalizeArgs(a,i,function(e,t){l=e,i=t}),l.speedSummary=l.speedSummary||new N(n),o===T.BlobTypes.BLOCK&&(l.storeBlobContentMD5=!1!==l.storeBlobContentMD5),r.pause();var c=this,u=function(){if(null===s||s>=c.singleBlobPutThresholdInBytes||o!==T.BlobTypes.BLOCK){var e=new O(r,{calcContentMd5:l.storeBlobContentMD5});c._uploadContentFromChunkStream(t,n,o,e,s,l,i)}else!function(){var e=function(e,t,n){i(e,t,n)};s>0&&g.objectIsNull(g.tryGetValueChain(l,["contentSettings","contentMD5"],null))&&l.storeBlobContentMD5?(g.calculateMD5(r,Math.min(c.singleBlobPutThresholdInBytes,s),l,function(o,r){g.setObjectInnerPropertyValue(l,["contentSettings","contentMD5"],r),c._putBlockBlob(t,n,o,null,o.length,l,e)}),r.resume()):c._putBlockBlob(t,n,null,r,s,l,e)}()};if(e)u();else{if(l.storeBlobContentMD5&&o!==T.BlobTypes.BLOCK)throw new Error(f.MD5_NOT_POSSIBLE);o===T.BlobTypes.APPEND||l.accessConditions?this.getBlobProperties(t,n,l,function(e,t,n){!e||l.accessConditions&&"*"===l.accessConditions.EtagNonMatch&&400===n.statusCode?(o===T.BlobTypes.APPEND&&(l.appendPosition=t.contentLength),u()):i(e)}):u()}return l.speedSummary},o.prototype._uploadBlobFromText=function(e,t,o,r,s,a,i){var l;g.normalizeArgs(a,i,function(e,t){l=e,i=t}),l.speedSummary=l.speedSummary||new N(o),l[B.CONTENT_TYPE]=l.contentSettings&&l.contentSettings.contentType||'text/plain;charset="utf-8"';var u=this,p=function(){var e,a=g.objectIsNull(s)?0:n.isBuffer(s)?s.length:n.byteLength(s);if(r===T.BlobTypes.BLOCK){if(l.storeBlobContentMD5=!1!==l.storeBlobContentMD5,e=u._putBlockBlob,a>T.MAX_SINGLE_UPLOAD_BLOB_SIZE_IN_BYTES)throw new RangeError(f.INVALID_BLOB_LENGTH)}else if(r===T.BlobTypes.APPEND&&(e=u._appendBlock,a>T.MAX_APPEND_BLOB_BLOCK_SIZE))throw new RangeError(f.INVALID_TEXT_LENGTH);e.call(u,t,o,s,null,a,l,function(e,n,s){r!==T.BlobTypes.BLOCK?u.setBlobProperties(t,o,l.contentSettings,function(e,t,o){t=c(!1,t,n),i(e,t,o)}):i(e,n,s)})};if(e)!g.objectIsNull(s)&&g.objectIsNull(g.tryGetValueChain(l,["contentSettings","contentMD5"],null))&&l.storeBlobContentMD5&&g.setObjectInnerPropertyValue(l,["contentSettings","contentMD5"],g.getContentMd5(s)),p();else{if(l.storeBlobContentMD5&&r!==T.BlobTypes.BLOCK)throw new Error(f.MD5_NOT_POSSIBLE);(r===T.BlobTypes.APPEND||l.accessConditions)&&this.getBlobProperties(t,o,l,function(e,t){e?i(e):(r===T.BlobTypes.APPEND&&(l.appendPosition=t.contentLength),p())})}},o.prototype._putBlockBlob=function(e,t,n,o,s,a,i){a.speedSummary||(a.speedSummary=new N(t));var l=a.speedSummary;l.totalSize=s;var c=r(e,t),u=_.put(c).withHeader(B.CONTENT_TYPE,"application/octet-stream").withHeader(B.BLOB_TYPE,T.BlobTypes.BLOCK).withHeader(B.CONTENT_LENGTH,s);!g.objectIsNull(n)&&g.objectIsNull(a.transactionalContentMD5)&&a.useTransactionalMD5&&(a.transactionalContentMD5=g.getContentMd5(n)),M.setHeadersFromBlob(u,a);var p=function(n,o){n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.getPropertiesFromHeaders(n.response.headers),a.metadata&&(n.blobResult.metadata=a.metadata));o(n,function(e){e&&e.error||l.increment(s),i(e.error,e.blobResult,e.response)})};return g.objectIsNull(n)?this.performRequestOutputStream(u,o,a,p):this.performRequest(u,n,a,p),a.speedSummary},o.prototype._appendBlock=function(e,t,n,o,s,a,i){var l=a.speedSummary||new N(t);l.totalSize=s;var c=this,u=function(){var u=r(e,t),p=_.put(u).withQueryOption(A.COMP,"appendblock").withHeader(B.CONTENT_LENGTH,s).withHeader(B.BLOB_CONDITION_MAX_SIZE,a.maxBlobSize).withHeader(B.BLOB_CONDITION_APPEND_POSITION,a.appendPosition);M.setHeadersFromBlob(p,a);var d=function(n,o){n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.getPropertiesFromHeaders(n.response.headers));o(n,function(e){e&&e.error||l.increment(s),i(e.error,e.blobResult,e.response)})};g.objectIsNull(n)?c.performRequestOutputStream(p,o,a,d):c.performRequest(p,n,a,d)};return g.objectIsNull(a.transactionalContentMD5)&&a.useTransactionalMD5?g.objectIsNull(n)?g.calculateMD5(o,s,a,function(e,t){a.transactionalContentMD5=t,n=e,s=e.length,u()}):(a.transactionalContentMD5=g.getContentMd5(n),u()):u(),a.speedSummary},o.prototype._leaseImpl=function(e,t,n,o,s,a){var i;if(g.objectIsNull(t))i=_.put(e).withQueryOption(A.RESTYPE,"container");else{E.validateArgs("_leaseImpl",function(e){e.string(t,"blob")});var l=r(e,t);i=_.put(l)}i.withQueryOption(A.COMP,"lease").withHeader(B.LEASE_ID,n).withHeader(B.LEASE_ACTION,o.toLowerCase()).withHeader(B.LEASE_BREAK_PERIOD,s.leaseBreakPeriod).withHeader(B.PROPOSED_LEASE_ID,s.proposedLeaseId).withHeader(B.LEASE_DURATION,s.leaseDuration);this.performRequest(i,null,s,function(n,o){n.leaseResult=null,n.error||(n.leaseResult=new w(e,t),n.leaseResult.getPropertiesFromHeaders(n.response.headers));o(n,function(e){a(e.error,e.leaseResult,e.response)})})},o.prototype._createPages=function(e,t,n,o,r,s,a,i){var l=this._updatePageBlobPagesImpl(e,t,r,s,T.PageWriteOptions.UPDATE,a);!g.objectIsNull(n)&&g.objectIsNull(a.transactionalContentMD5)&&a.useTransactionalMD5&&l.withHeader(B.CONTENT_MD5,g.getContentMd5(n));var c=function(n,o){n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.getPropertiesFromHeaders(n.response.headers));o(n,function(e){i(e.error,e.blobResult,e.response)})};g.objectIsNull(n)?this.performRequestOutputStream(l,o,a,c):this.performRequest(l,n,a,c)},o.prototype._updatePageBlobPagesImpl=function(e,t,n,o,s,a){if(n&&n%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_START_OFFSET);if(o&&(o+1)%T.PAGE_SIZE!=0)throw new RangeError(f.INVALID_PAGE_END_OFFSET);a||(a={}),a.rangeStart=n,a.rangeEnd=o,a.contentLength=s===T.PageWriteOptions.UPDATE?o-n+1:0;var i=r(e,t),l=_.put(i).withQueryOption(A.COMP,"page").withHeader(B.CONTENT_TYPE,"application/octet-stream").withHeader(B.PAGE_WRITE,s);return M.setHeadersFromBlob(l,a),l},o.prototype._uploadContentFromChunkStream=function(e,t,n,o,r,s,a){this.logger.debug(i.format("_uploadContentFromChunkStream for blob %s",t));var l,u,p,d,b,m=g.tryGetValueChain(s,["contentSettings","contentMD5"],null),E=s.parallelOperationThreadCount||this.parallelOperationThreadCount;if(n==T.BlobTypes.BLOCK){l="createBlockFromText",u=!0;var h=Math.ceil(r/5e4);if(s.blockSize){if(s.blockSize<h){_=new F("options.blockSize",i.format("The minimum blockSize is %s and the provided blockSize %s is too small.",h,s.blockSize));return void a(_)}b=s.blockSize}else b=Math.max(h,T.DEFAULT_WRITE_BLOCK_SIZE_IN_BYTES)}else if(n==T.BlobTypes.PAGE)l="_createPages",p=!0,b=T.DEFAULT_WRITE_PAGE_SIZE_IN_BYTES;else{if(n!=T.BlobTypes.APPEND){var _=new F("blobType",i.format("Unknown blob type %s",n));return void a(_)}l="appendBlockFromText",d=!0,E=1,b=T.DEFAULT_WRITE_BLOCK_SIZE_IN_BYTES}o._highWaterMark=b,this._setOperationExpiryTime(s);var S=s.speedSummary||new N(t);S.totalSize=r;var B=new y(b,E,{logger:this.logger});o.setOutputLength(r),o._stream&&o._stream.setMemoryAllocator&&o._stream.setMemoryAllocator(B);var A=new I(l,{callInOrder:d,callbackInOrder:d,logger:this.logger,enableReuseSocket:this.defaultEnableReuseSocket});A.setConcurrency(E);var R={leaseId:s.leaseId,timeoutIntervalInMs:s.timeoutIntervalInMs,clientRequestTimeoutInMs:s.clientRequestTimeoutInMs,operationExpiryTime:s.operationExpiryTime,maxBlobSize:s.maxBlobSize,appendPosition:s.appendPosition||0,initialAppendPosition:s.appendPosition||0,absorbConditionalErrorsOnRetry:s.absorbConditionalErrorsOnRetry},C=s.blockIdPrefix||this.generateBlockIdPrefix(),O=0,P=[],v={},L=this;return o.on("data",function(n,a){var c=null,m=!1,E=S.getAutoIncrementFunction(n.length);if(n.length>b)throw new RangeError(i.format(f.EXCEEDED_SIZE_LIMITATION,b,n.length));if(s.useTransactionalMD5){var h=g.getContentMd5(n);R.transactionalContentMD5=h}var _=function(){return!r||(a.start>=r?(L.logger.debug(i.format("Stop uploading data from %s bytes to %s bytes to blob %s because of limit %s",a.start,a.end,t,r)),o.stop(),!1):(a.end>=r&&(L.logger.debug(i.format("Clip uploading data from %s bytes to %s bytes to blob %s because of limit %s",a.start,a.end,t,r)),a.end=r-1,n=n.slice(0,r-a.start),s.useTransactionalMD5&&(R.transactionalContentMD5=g.getContentMd5(n))),!0))};u?function(){if(_()){var r=L.getBlockId(C,O);P.push(r),c=new I.RestOperation(L,l,r,e,t,n,R,function(e){e?(L.logger.debug(i.format("Stop uploading data as error happens. Error: %s",i.inspect(e))),o.stop()):E(),B.releaseBuffer(n),n=null}),O++}}():d?function(){if(_()){if(R.appendPosition=Number(R.initialAppendPosition)+Number(a.start),s.maxBlobSize&&R.appendPosition+n.length>s.maxBlobSize)throw new Error(f.MAX_BLOB_SIZE_CONDITION_NOT_MEET);c=new I.RestOperation(L,l,e,t,n,R,function(e,t){e?(L.logger.debug(i.format("Stop uploading data as error happens. Error: %s",i.inspect(e))),o.stop()):E(),v=t,B.releaseBuffer(n),n=null})}}():p&&_()&&(g.isBufferAllZero(n)?(L.logger.debug(i.format("Skip upload data from %s bytes to %s bytes to blob %s",a.start,a.end,t)),S.increment(n.length)):(L.logger.debug(i.format("Upload data from %s bytes to %s bytes to blob %s",a.start,a.end,t)),c=new I.RestOperation(L,l,e,t,n,null,a.start,a.end,R,function(e){e?(L.logger.debug(i.format("Stop uploading data as error happens. Error: %s",i.inspect(e))),o.stop()):E(),B.releaseBuffer(n),n=null}))),c&&(m=A.addOperation(c),c=null,m&&(L.logger.debug("File stream paused"),o.pause()))}),o.on("end",function(){L.logger.debug(i.format("File read stream ended for blob %s",t)),A.enableComplete()}),A.on("drain",function(){L.logger.debug("file stream resume"),o.resume()}),A.on("end",function(n){if(L.logger.debug("batch operations commited"),S=null,n)a(n);else{if(m)s.contentSettings.contentMD5=m;else if(s.storeBlobContentMD5){var r=o.getContentMd5("base64");g.setObjectInnerPropertyValue(s,["contentSettings","contentMD5"],r)}if(u){var l={UncommittedBlocks:P};L.commitBlocks(e,t,l,s,function(e,n,r){L.logger.debug(i.format("Blob %s committed",t)),e?(o.finish(),a(e)):(v.commmittedBlocks=P,o.finish(),a(e,v,r))})}else{var p=s.contentSettings;L.setBlobProperties(e,t,p,function(e,t,n){o.finish(),t=c(!1,t,v),a(e,t,n)})}}}),S},o.prototype._doesContainerExist=function(e,t,n,o){var r=_.head(e).withQueryOption(A.RESTYPE,"container").withHeader(B.LEASE_ID,n.leaseId);!1===t&&(n.requestLocationMode=R.PRIMARY_OR_SECONDARY);this.performRequest(r,null,n,function(t,n){t.containerResult=new D(e),t.error?t.error&&t.error.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&(t.error=null,t.containerResult.exists=!1,t.response.isSuccessful=!0):(t.containerResult.exists=!0,t.containerResult.getPropertiesFromHeaders(t.response.headers));n(t,function(e){o(e.error,e.containerResult,e.response)})})},o.prototype._doesBlobExist=function(e,t,n,o,s){var a=r(e,t),i=_.head(a).withQueryOption(A.SNAPSHOT,o.snapshotId).withHeader(B.LEASE_ID,o.leaseId);!1===n&&(o.requestLocationMode=R.PRIMARY_OR_SECONDARY);this.performRequest(i,null,o,function(n,o){n.blobResult=new M(e,t),n.error?n.error&&n.error.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&(n.error=null,n.blobResult.exists=!1,n.response.isSuccessful=!0):(n.blobResult.exists=!0,n.blobResult.getPropertiesFromHeaders(n.response.headers));o(n,function(e){s(e.error,e.blobResult,e.response)})})},o.prototype._setBlobPropertiesHelper=function(e){this.performRequest(e.webResource,null,e.options,function(t,n){t.blobResult=null,t.error||(t.blobResult=new M(e.container,e.blob),t.blobResult.getPropertiesFromHeaders(t.response.headers));n(t,function(t){e.callback(t.error,t.blobResult,t.response)})})},o.prototype._validateLengthAndMD5=function(e,t){var o,r=t.response.headers[S.HeaderConstants.CONTENT_MD5];g.objectIsNull(t.response.headers[S.HeaderConstants.CONTENT_LENGTH])||(o=parseInt(t.response.headers[S.HeaderConstants.CONTENT_LENGTH],10)),g.objectIsNull(e.disableContentMD5Validation)&&(e.disableContentMD5Validation=!1),!1===e.disableContentMD5Validation&&!0===e.useTransactionalMD5&&g.objectIsNull(r)&&(t.error=new V(f.MD5_NOT_PRESENT_ERROR),t.retryable=!1),g.objectIsNull(t.length)&&("string"==typeof t.response.body?t.length=n.byteLength(t.response.body):n.isBuffer(t.response.body)&&(t.length=t.response.body.length)),g.objectIsNull(o)||t.length===o||(t.error=new Error(f.CONTENT_LENGTH_MISMATCH),t.retryable=!1),!1===e.disableContentMD5Validation&&g.objectIsNull(t.contentMD5)&&(t.contentMD5=g.getContentMd5(t.response.body)),!1!==e.disableContentMD5Validation||g.objectIsNull(r)||r===t.contentMD5||(t.error=new Error(i.format(f.HASH_MISMATCH,r,t.contentMD5)),t.retryable=!1)},o.prototype._setRangeContentMD5Header=function(e,t){if(!g.objectIsNull(t.rangeStart)&&t.useTransactionalMD5){if(g.objectIsNull(t.rangeEnd))throw new x("options.rangeEndHeader",i.format(f.ARGUMENT_NULL_OR_EMPTY,t.rangeEndHeader));if(parseInt(t.rangeEnd,10)-parseInt(t.rangeStart,10)+1>T.MAX_RANGE_GET_SIZE_WITH_MD5)throw new F("options",f.INVALID_RANGE_FOR_MD5);e.withHeader(B.RANGE_GET_CONTENT_MD5,"true")}},o.prototype._getBlobToRangeStream=function(e,t,n,o,r,s){var a;g.normalizeArgs(r,s,function(e,t){a=e,s=t}),E.validateArgs("_getBlobToRangeStream",function(o){o.string(e,"container"),o.string(t,"blob"),o.containerNameIsValid(e),o.blobNameIsValid(e,t),o.blobTypeIsValid(n),o.callback(s)});var l=null,c=!0;n==T.BlobTypes.PAGE?l=new b(this,e,t,a):n==T.BlobTypes.APPEND?(l=new m(this,e,t,a),c=!1):n==T.BlobTypes.BLOCK&&(l=new p(this,e,t,a),c=!1),a.speedSummary||(a.speedSummary=new N(t));var u=a.speedSummary,f=a.parallelOperationThreadCount||this.parallelOperationThreadCount,h=new I("getBlobInRanges",{callbackInOrder:!0,logger:this.logger,enableReuseSocket:this.defaultEnableReuseSocket});h.setConcurrency(f);var _=this,S=null;!a.disableContentMD5Validation&&(S=(new d).createMd5Hash());var B=null,A=null;l.on("range",function(n){u.totalSize||(u.totalSize=l.rangeSize);var r={rangeStart:n.start,rangeEnd:n.end,responseEncoding:null},s=n.size;if(r.timeoutIntervalInMs=a.timeoutIntervalInMs,r.clientRequestTimeoutInMs=a.clientRequestTimeoutInMs,r.useTransactionalMD5=a.useTransactionalMD5,0!==n.dataSize){if(!(n.start>n.end)){var p=new I.RestOperation(_,"getBlobToText",e,t,r,function(e,t,n,r){if(e)_.logger.debug(i.format("Stop downloading data as error happens. Error: %s",i.inspect(e))),l.stop();else{s!==t.length&&_.logger.warn(i.format("Request %s bytes, but server returns %s bytes",s,t.length)),B||(B=n),A||(A=r);var a=u.getAutoIncrementFunction(t.length);o.write(t,a)||(_.logger.debug("Write stream is full and pause batch operation"),h.pause()),S&&S.update(t),t=null}});h.addOperation(p)&&(_.logger.debug("Pause range stream"),l.pause())}}else if(c){var d=u.getAutoIncrementFunction(s),b=new I.CommonOperation(I.noOperation,function(e){if(!e){var t=g.writeZerosToStream(o,s,S,d);_.logger.debug(i.format("Write %s bytes Zero from %s to %s",s,n.start,n.end)),t||(_.logger.debug("Write stream is full and pause batch operation"),h.pause())}});h.addOperation(b)}else _.logger.debug(i.format("Can not read %s bytes to %s bytes of blob %s",n.start,n.end,t))}),l.on("end",function(){_.logger.debug("Range stream has ended."),h.enableComplete()}),h.on("drain",function(){_.logger.debug("Resume range stream"),l.resume()}),o.on("drain",function(){_.logger.debug("Resume batch operations"),h.resume()}),h.on("end",function(e){_.logger.debug("Download completed!"),e?s(e):o.end(function(){_.logger.debug("Write stream has ended"),o.close&&o.close(),B||(B={}),g.setObjectInnerPropertyValue(B,["contentSettings","contentMD5"],g.tryGetValueChain(a,["contentSettings","contentMD5"],null)),B.clientSideContentMD5=null,S&&(B.clientSideContentMD5=S.digest("base64")),s(e,B,A)})});var R={timeoutIntervalInMs:a.timeoutIntervalInMs,clientRequestTimeoutInMs:a.clientRequestTimeoutInMs,snapshotId:a.snapshotId,leaseId:a.leaseId,blockListFilter:k.BlockListFilter.COMMITTED};return l.list(R,function(e){s(e)}),u},o.prototype._getBlobToStream=function(e,t,n,o,s){var a;g.normalizeArgs(o,s,function(e,t){a=e,s=t});var i=r(e,t),l=_.get(i).withRawResponse(),u=c(!0,{},a);l.withQueryOption(A.SNAPSHOT,u.snapshotId),M.setHeadersFromBlob(l,u),this._setRangeContentMD5Header(l,u);var p=this;this.performRequestInputStream(l,null,n,u,function(n,o){n.blobResult=null,n.error||(n.blobResult=new M(e,t),n.blobResult.metadata=p.parseMetadataHeaders(n.response.headers),n.blobResult.getPropertiesFromHeaders(n.response.headers),p._validateLengthAndMD5(u,n));o(n,function(e){s(e.error,e.blobResult,e.response)})})},o.prototype._listBlobsOrDircotriesSegmentedWithPrefix=function(e,t,n,o,r,s){var a;g.normalizeArgs(r,s,function(e,t){a=e,s=t}),E.validateArgs("listBlobsSegmented",function(t){t.string(e,"container"),t.containerNameIsValid(e),t.callback(s)});var i=c(!0,{},a),u=_.get(e).withQueryOption(A.RESTYPE,"container").withQueryOption(A.COMP,"list").withQueryOption(A.MAX_RESULTS,i.maxResults).withQueryOptions(i,A.DELIMITER,A.INCLUDE);g.objectIsNull(n)||u.withQueryOption(A.MARKER,n.nextMarker),u.withQueryOption(A.PREFIX,t),i.requestLocationMode=g.getNextListingLocationMode(n);this.performRequest(u,null,i,function(e,t){if(e.listBlobsResult=null,!e.error){e.listBlobsResult={entries:null,continuationToken:null},e.listBlobsResult.entries=[];var n=[];o==T.ListBlobTypes.Directory&&e.response.body.EnumerationResults.Blobs.BlobPrefix?(n=e.response.body.EnumerationResults.Blobs.BlobPrefix,l.isArray(n)||(n=[n])):o==T.ListBlobTypes.Blob&&e.response.body.EnumerationResults.Blobs.Blob&&(n=e.response.body.EnumerationResults.Blobs.Blob,l.isArray(n)||(n=[n])),n.forEach(function(t){var n=M.parse(t);e.listBlobsResult.entries.push(n)}),e.response.body.EnumerationResults.NextMarker&&(e.listBlobsResult.continuationToken={nextMarker:null,targetLocation:null},e.listBlobsResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listBlobsResult.continuationToken.targetLocation=e.targetLocation)}t(e,function(e){s(e.error,e.listBlobsResult,e.response)})})},o.prototype._createBlob=function(e,t,n,o,r,s){n==T.BlobTypes.APPEND?this.createOrReplaceAppendBlob(e,t,r,function(e,t){s(e,null,t)}):n==T.BlobTypes.PAGE?this.createPageBlob(e,t,o,r,function(e){s(e)}):n==T.BlobTypes.BLOCK&&s()},o.SpeedSummary=N,t.exports=o}).call(this,e("buffer").Buffer)},{"../../common/errors/errors":8,"./../../common/common.core":6,"./../../common/md5-wrapper":13,"./../../common/streams/rangestream":28,"./blobutilities":41,"./internal/blockrangestream":42,"./internal/pagerangestream":43,"./models/blobresult":44,"./models/blocklistresult":45,"./models/containerresult":46,"./models/leaseresult":47,buffer:"buffer",extend:153,querystring:203,underscore:244,url:245,util:"util"}],47:[function(e,t,n){function o(e,t,n,o){e&&(this.container=e),t&&(this.blob=t),n&&(this.id=n),o&&(this.time=o)}var r=e("./../../../common/common.core").Constants.HeaderConstants;o.prototype.getPropertiesFromHeaders=function(e){var t=this;!t.id&&e[r.LEASE_ID]&&(t.id=e[r.LEASE_ID]),!t.time&&e[r.LEASE_TIME]&&(t.time=parseInt(e[r.LEASE_TIME],10)),t.etag=e[r.ETAG],t.lastModified=e[r.LAST_MODIFIED.toLowerCase()]},t.exports=o},{"./../../../common/common.core":6}],46:[function(e,t,n){function o(e,t){e&&(this.name=e),t&&(this.publicAccessLevel=t)}var r=e("./../../../common/common.core"),s=r.util,a=r.Constants.HeaderConstants,i=e("../blobutilities");o.parse=function(e){var t=new o;for(var n in e)if(e.hasOwnProperty(n))if("Properties"===n)s.setPropertyValueFromXML(t,e[n],!0);else if("Metadata"===n){var r=s.normalizePropertyNameFromXML(n);t[r]={},s.setPropertyValueFromXML(t[r],e[n],!1)}else t[n.toLowerCase()]=e[n];return t.publicAccessLevel||(t.publicAccessLevel=i.BlobContainerPublicAccessType.OFF),t},o.prototype.getPropertiesFromHeaders=function(e){var t=this,n=function(n,o){!s.tryGetValueChain(t,n.split("."),null)&&e[o.toLowerCase()]&&s.setObjectInnerPropertyValue(t,n.split("."),e[o.toLowerCase()])};n("etag",a.ETAG),n("lastModified",a.LAST_MODIFIED),n("lease.status",a.LEASE_STATUS),n("lease.state",a.LEASE_STATE),n("lease.duration",a.LEASE_DURATION),n("requestId",a.REQUEST_ID),t.publicAccessLevel||(t.publicAccessLevel=i.BlobContainerPublicAccessType.OFF,e[a.BLOB_PUBLIC_ACCESS]&&(t.publicAccessLevel=e[a.BLOB_PUBLIC_ACCESS])),"true"===t.publicAccessLevel&&(t.publicAccessLevel=i.BlobContainerPublicAccessType.CONTAINER)},t.exports=o},{"../blobutilities":41,"./../../../common/common.core":6}],45:[function(e,t,n){(function(t){var o=e("underscore"),r=e("./../../../common/common.core"),s=r.xmlbuilder,a=r.Constants;n.serialize=function(e){var n=s.create();return n=n.begin(a.BlobConstants.BLOCK_LIST_ELEMENT,{version:"1.0",encoding:"utf-8"}),e.LatestBlocks&&e.LatestBlocks.forEach(function(e){n=n.ele(a.BlobConstants.LATEST_ELEMENT).txt(new t(e).toString("base64")).up()}),e.CommittedBlocks&&e.CommittedBlocks.forEach(function(e){n=n.ele(a.BlobConstants.COMMITTED_ELEMENT).txt(new t(e).toString("base64")).up()}),e.UncommittedBlocks&&e.UncommittedBlocks.forEach(function(e){n=n.ele(a.BlobConstants.UNCOMMITTED_ELEMENT).txt(new t(e).toString("base64")).up()}),n.doc().toString()},n.parse=function(e){var n={};return e.CommittedBlocks&&e.CommittedBlocks.Block&&(n.CommittedBlocks=e.CommittedBlocks.Block,o.isArray(n.CommittedBlocks)||(n.CommittedBlocks=[n.CommittedBlocks]),n.CommittedBlocks.forEach(function(e){e.Name=new t(e.Name,"base64").toString()})),e.UncommittedBlocks&&e.UncommittedBlocks.Block&&(n.UncommittedBlocks=e.UncommittedBlocks.Block,o.isArray(n.UncommittedBlocks)||(n.UncommittedBlocks=[n.UncommittedBlocks]),n.UncommittedBlocks.forEach(function(e){e.Name=new t(e.Name,"base64").toString()})),n}}).call(this,e("buffer").Buffer)},{"./../../../common/common.core":6,buffer:"buffer",underscore:244}],44:[function(e,t,n){function o(e,t){e&&(this.container=e),t&&(this.name=t)}var r=e("underscore"),s=e("./../../../common/common.core"),a=s.util,i=s.Constants.HeaderConstants;o.parse=function(e){var t=new o;for(var n in e)if(e.hasOwnProperty(n))if("Properties"===n)a.setPropertyValueFromXML(t,e[n],!0);else if("Metadata"===n){var r=a.normalizePropertyNameFromXML(n);t[r]={},a.setPropertyValueFromXML(t[r],e[n],!1)}else t[n.toLowerCase()]=e[n];return void 0!==t.isIncrementalCopy&&(t.isIncrementalCopy="true"==t.isIncrementalCopy),t};var l={lastModified:"LAST_MODIFIED",etag:"ETAG",sequenceNumber:"SEQUENCE_NUMBER",blobType:"BLOB_TYPE",contentLength:"CONTENT_LENGTH",blobContentLength:"BLOB_CONTENT_LENGTH",contentRange:"CONTENT_RANGE",committedBlockCount:"BLOB_COMMITTED_BLOCK_COUNT",serverEncrypted:"SERVER_ENCRYPTED",requestId:"REQUEST_ID",range:"RANGE",blobRange:"STORAGE_RANGE",getContentMd5:"RANGE_GET_CONTENT_MD5",acceptRanges:"ACCEPT_RANGES",appendOffset:"BLOB_APPEND_OFFSET",isIncrementalCopy:"INCREMENTAL_COPY","contentSettings.contentType":"CONTENT_TYPE","contentSettings.contentEncoding":"CONTENT_ENCODING","contentSettings.contentLanguage":"CONTENT_LANGUAGE","contentSettings.cacheControl":"CACHE_CONTROL","contentSettings.contentDisposition":"CONTENT_DISPOSITION","contentSettings.contentMD5":"CONTENT_MD5","lease.id":"LEASE_ID","lease.status":"LEASE_STATUS","lease.duration":"LEASE_DURATION","lease.state":"LEASE_STATE","copy.id":"COPY_ID","copy.status":"COPY_STATUS","copy.source":"COPY_SOURCE","copy.progress":"COPY_PROGRESS","copy.completionTime":"COPY_COMPLETION_TIME","copy.statusDescription":"COPY_STATUS_DESCRIPTION","copy.destinationSnapshot":"COPY_DESTINATION_SNAPSHOT"};o.prototype.getPropertiesFromHeaders=function(e){var t=this,n=function(n,o){if(!a.tryGetValueChain(t,n.split("."),null)&&e[o.toLowerCase()]&&(a.setObjectInnerPropertyValue(t,n.split("."),e[o.toLowerCase()]),"copy.progress"===n)){var r=a.parseCopyProgress(t.copy.progress);t.copy.bytesCopied=parseInt(r.bytesCopied),t.copy.totalBytes=parseInt(r.totalBytes)}};n("contentSettings.contentMD5",i.BLOB_CONTENT_MD5),r.chain(l).pairs().each(function(e){var t=e[0],o=i[e[1]];n(t,o)}),void 0!==t.isIncrementalCopy&&(t.isIncrementalCopy="true"==t.isIncrementalCopy)},o.setHeadersFromBlob=function(e,t){var n=function(n,o){var r=a.tryGetValueChain(t,o.split("."),null);r&&e.withHeader(n,r)};if(t){if(n(i.BLOB_CONTENT_TYPE,"contentSettings.contentType"),n(i.BLOB_CONTENT_ENCODING,"contentSettings.contentEncoding"),n(i.BLOB_CONTENT_LANGUAGE,"contentSettings.contentLanguage"),n(i.BLOB_CONTENT_DISPOSITION,"contentSettings.contentDisposition"),n(i.BLOB_CACHE_CONTROL,"contentSettings.cacheControl"),n(i.BLOB_CONTENT_MD5,"contentSettings.contentMD5"),n(i.CONTENT_LENGTH,"contentLength"),n(i.CONTENT_MD5,"transactionalContentMD5"),!a.objectIsNull(t.rangeStart)){var o="bytes="+t.rangeStart+"-";a.objectIsNull(t.rangeEnd)||(o+=t.rangeEnd),e.withHeader(i.RANGE,o)}n(i.BLOB_TYPE,"blobType"),n(i.LEASE_ID,"leaseId"),n(i.SEQUENCE_NUMBER,"sequenceNumber"),n(i.SEQUENCE_NUMBER_ACTION,"sequenceNumberAction"),t.metadata&&e.addOptionalMetadataHeaders(t.metadata)}},o.setPropertiesFromBlob=function(e,t){var n=function(n,o){var r=a.tryGetValueChain(t,o.split("."),null);r&&e.withHeader(n,r)};t&&(n(i.BLOB_CONTENT_TYPE,"contentSettings.contentType"),n(i.BLOB_CONTENT_ENCODING,"contentSettings.contentEncoding"),n(i.BLOB_CONTENT_LANGUAGE,"contentSettings.contentLanguage"),n(i.BLOB_CONTENT_DISPOSITION,"contentSettings.contentDisposition"),n(i.BLOB_CACHE_CONTROL,"contentSettings.cacheControl"),n(i.BLOB_CONTENT_MD5,"contentSettings.contentMD5"),n(i.LEASE_ID,"leaseId"),t.metadata&&e.addOptionalMetadataHeaders(t.metadata))},t.exports=o},{"./../../../common/common.core":6,underscore:244}],43:[function(e,t,n){function o(e,t,n,r){o.super_.call(this,e,t,n,r),r.minRangeSize?this._minRangeSize=r.minRangeSize:this._minRangeSize=a.BlobConstants.MIN_WRITE_PAGE_SIZE_IN_BYTES,r.maxRangeSize?this._maxRangeSize=r.maxRangeSize:this._maxRangeSize=a.BlobConstants.DEFAULT_WRITE_PAGE_SIZE_IN_BYTES,this._lengthHeader=a.HeaderConstants.BLOB_CONTENT_LENGTH,this._listFunc=e.listPageRanges}var r=e("util"),s=e("./../../../common/streams/rangestream"),a=e("./../../../common/util/constants");r.inherits(o,s),t.exports=o},{"./../../../common/streams/rangestream":28,"./../../../common/util/constants":31,util:"util"}],42:[function(e,t,n){function o(e,t,n,o){this.blobServiceClient=e,this.container=t,this.blob=n,this._emitter=new s,this._paused=!1,this._emittedAll=!1,this._emittedRangeType=null,this._emittedRangeIndex=null,this._offset=0,this._rangelist=[],this._isEmitting=!1,o.rangeStart?this._startOffset=o.rangeStart:this._startOffset=0,o.rangeEnd?this._endOffset=o.rangeEnd:this._endOffset=Number.MAX_VALUE}var r=e("./../../../common/util/constants"),s=e("events").EventEmitter,a=e("./../blobutilities");o.prototype.on=function(e,t){this._emitter.on(e,t)},o.prototype.list=function(e,t){e||(e={}),e.blockListFilter||(e.blockListFilter=a.BlockListFilter.ALL);var n=this;this.blobServiceClient.listBlocks(this.container,this.blob,e.blockListFilter,e,function(e,o,s){if(e)t(e);else{var a=parseInt(s.headers[r.HeaderConstants.BLOB_CONTENT_LENGTH],10);if(!o.CommittedBlocks){o.CommittedBlocks=[{Name:"NODESDK_BLOCKBLOB_RANGESTREAM",Size:a}]}n._rangelist=o,n._emitBlockList(),n=o=null}})},o.prototype._emitBlockList=function(){if(!(this._paused||this._emittedAll||this._isEmitting)){var e=this;this._getTypeList(function(){e._rangelist=null,e._emittedAll=!0,e._emitter.emit("end")})}},o.prototype._getTypeList=function(e){this._isEmitting=!0;try{var t=!1;if(this._rangelist)for(var n in this._rangelist)if(this._rangelist.hasOwnProperty(n)){if(null===this._emittedRangeType||t||this._emittedRangeType==n)this._emittedRangeType=n,t=!0;else if(this._emittedRangeType!==n)continue;if(this._paused)return;this._emitBlockRange(n,e)}}finally{this._isEmitting=!1}},o.prototype._emitBlockRange=function(e,t){for(var n=this._rangelist[e],o=!1,r=0;r<n.length;r++){if(null===this._emittedRangeIndex||o||this._emittedRangeIndex===r)this._emittedRangeIndex=r,o=!0;else if(this._emittedRangeIndex!==r)continue;if(this._paused)return;var s=n[r];if(s.name=s.Name,s.type=e,s.start=this._offset,this._offset+=parseInt(s.Size,10),s.end=this._offset-1,delete s.Name,delete s.Size,s.start>this._endOffset)break;s.end<this._startOffset||(s.start=Math.max(s.start,this._startOffset),s.end=Math.min(s.end,this._endOffset),s.size=s.end-s.start+1,s.dataSize=s.size,this._emitter.emit("range",s))}this._rangelist[e]=null,t()},o.prototype.pause=function(){this._paused=!0},o.prototype.resume=function(){this._paused=!1,this._isEmitting||this._emitBlockList()},o.prototype.stop=function(){this.pause(),this._emittedAll=!0,this._emitter.emit("end")},t.exports=o},{"./../../../common/util/constants":31,"./../blobutilities":41,events:151}],41:[function(e,t,n){t.exports;var o={SharedAccessPermissions:{READ:"r",ADD:"a",CREATE:"c",WRITE:"w",DELETE:"d",LIST:"l"},BlobListingDetails:{SNAPSHOTS:"snapshots",METADATA:"metadata",UNCOMMITTED_BLOBS:"uncommittedblobs",COPY:"copy"},SnapshotDeleteOptions:{SNAPSHOTS_ONLY:"only",BLOB_AND_SNAPSHOTS:"include"},BlockListFilter:{ALL:"all",COMMITTED:"committed",UNCOMMITTED:"uncommitted"},BlobContainerPublicAccessType:{OFF:null,CONTAINER:"container",BLOB:"blob"},SequenceNumberAction:{MAX:"max",UPDATE:"update",INCREMENT:"increment"}};t.exports=o},{}]},{},[1]);
